class Combobox{constructor(t,e,{tabInsertsSuggestions:i,defaultFirstOption:n,scrollIntoViewOptions:o}={}){this.input=t;this.list=e;this.tabInsertsSuggestions=i===null||i===void 0||i;this.defaultFirstOption=n!==null&&n!==void 0&&n;this.scrollIntoViewOptions=o!==null&&o!==void 0?o:{block:"nearest",inline:"nearest"};this.isComposing=false;e.id||(e.id=`combobox-${Math.random().toString().slice(2,6)}`);this.ctrlBindings=!!navigator.userAgent.match(/Macintosh/);this.keyboardEventHandler=t=>keyboardBindings(t,this);this.compositionEventHandler=t=>trackComposition(t,this);this.inputHandler=this.clearSelection.bind(this);t.setAttribute("role","combobox");t.setAttribute("aria-controls",e.id);t.setAttribute("aria-expanded","false");t.setAttribute("aria-autocomplete","list");t.setAttribute("aria-haspopup","listbox")}destroy(){this.clearSelection();this.stop();this.input.removeAttribute("role");this.input.removeAttribute("aria-controls");this.input.removeAttribute("aria-expanded");this.input.removeAttribute("aria-autocomplete");this.input.removeAttribute("aria-haspopup")}start(){this.input.setAttribute("aria-expanded","true");this.input.addEventListener("compositionstart",this.compositionEventHandler);this.input.addEventListener("compositionend",this.compositionEventHandler);this.input.addEventListener("input",this.inputHandler);this.input.addEventListener("keydown",this.keyboardEventHandler);this.list.addEventListener("click",commitWithElement);this.indicateDefaultOption()}stop(){this.clearSelection();this.input.setAttribute("aria-expanded","false");this.input.removeEventListener("compositionstart",this.compositionEventHandler);this.input.removeEventListener("compositionend",this.compositionEventHandler);this.input.removeEventListener("input",this.inputHandler);this.input.removeEventListener("keydown",this.keyboardEventHandler);this.list.removeEventListener("click",commitWithElement)}indicateDefaultOption(){var t;this.defaultFirstOption&&((t=Array.from(this.list.querySelectorAll('[role="option"]:not([aria-disabled="true"])')).filter(visible)[0])===null||t===void 0?void 0:t.setAttribute("data-combobox-option-default","true"))}navigate(t=1){const e=Array.from(this.list.querySelectorAll('[aria-selected="true"]')).filter(visible)[0];const i=Array.from(this.list.querySelectorAll('[role="option"]')).filter(visible);const n=i.indexOf(e);if(n===i.length-1&&t===1||n===0&&t===-1){this.clearSelection();this.input.focus();return}let o=t===1?0:i.length-1;if(e&&n>=0){const e=n+t;e>=0&&e<i.length&&(o=e)}const r=i[o];if(r)for(const t of i){t.removeAttribute("data-combobox-option-default");if(r===t){this.input.setAttribute("aria-activedescendant",r.id);r.setAttribute("aria-selected","true");fireSelectEvent(r);r.scrollIntoView(this.scrollIntoViewOptions)}else t.removeAttribute("aria-selected")}}clearSelection(){this.input.removeAttribute("aria-activedescendant");for(const t of this.list.querySelectorAll('[aria-selected="true"]'))t.removeAttribute("aria-selected");this.indicateDefaultOption()}}function keyboardBindings(t,e){if(!(t.shiftKey||t.metaKey||t.altKey)&&(e.ctrlBindings||!t.ctrlKey)&&!e.isComposing)switch(t.key){case"Enter":commit(e.input,e.list)&&t.preventDefault();break;case"Tab":e.tabInsertsSuggestions&&commit(e.input,e.list)&&t.preventDefault();break;case"Escape":e.clearSelection();break;case"ArrowDown":e.navigate(1);t.preventDefault();break;case"ArrowUp":e.navigate(-1);t.preventDefault();break;case"n":if(e.ctrlBindings&&t.ctrlKey){e.navigate(1);t.preventDefault()}break;case"p":if(e.ctrlBindings&&t.ctrlKey){e.navigate(-1);t.preventDefault()}break;default:if(t.ctrlKey)break;e.clearSelection()}}function commitWithElement(t){if(!(t.target instanceof Element))return;const e=t.target.closest('[role="option"]');e&&e.getAttribute("aria-disabled")!=="true"&&fireCommitEvent(e,{event:t})}function commit(t,e){const i=e.querySelector('[aria-selected="true"], [data-combobox-option-default="true"]');if(!i)return false;if(i.getAttribute("aria-disabled")==="true")return true;i.click();return true}function fireCommitEvent(t,e){t.dispatchEvent(new CustomEvent("combobox-commit",{bubbles:true,detail:e}))}function fireSelectEvent(t){t.dispatchEvent(new Event("combobox-select",{bubbles:true}))}function visible(t){return!t.hidden&&!(t instanceof HTMLInputElement&&t.type==="hidden")&&(t.offsetWidth>0||t.offsetHeight>0)}function trackComposition(t,e){e.isComposing=t.type==="compositionstart";const i=document.getElementById(e.input.getAttribute("aria-controls")||"");i&&e.clearSelection()}export{Combobox as default};

